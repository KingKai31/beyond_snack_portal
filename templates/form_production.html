{% extends "base.html" %}
{% block content %}

<style>
  .card-box {
    max-width: 520px;
    margin: auto;
    background: #ffffff;
    padding: 22px;
    border-radius: 14px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  }

  .btn-group {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .btn-group .button {
    flex: 1;
  }

  .button.is-selected {
    background-color: #3273dc;
    color: #ffffff;
  }

  .hidden {
    display: none;
  }
</style>

<div class="card-box">
  <h1 class="title is-4 has-text-centered">Production Log Entry</h1>

  <form method="POST" id="logForm">

    <!-- LINE -->
    <div class="field">
      <label class="label">Line *</label>
      <div class="btn-group">
        <button type="button" class="button is-light"
          onclick="setValue('line','Line 1',this)">Line 1</button>
        <button type="button" class="button is-light"
          onclick="setValue('line','Line 2',this)">Line 2</button>
      </div>
      <input type="hidden" name="line" id="line" required>
    </div>

    <!-- ACTION -->
    <div class="field">
      <label class="label">Action *</label>
      <div class="btn-group">
        <button type="button" class="button is-light"
          onclick="setAction('Start',this)">Start</button>
        <button type="button" class="button is-light"
          onclick="setAction('Stop',this)">Stop</button>
      </div>
      <input type="hidden" name="action" id="action" required>
    </div>

    <!-- STOP REASON -->
    <div class="field hidden" id="stopReasonBox">
      <label class="label">Stop Reason *</label>
      <div class="select is-fullwidth">
        <select name="stop_reason" id="stop_reason" onchange="handleOther()">
          <option value="">Select reason</option>
          <option>Blade change</option>
          <option>Seasoning drum cleaning</option>
          <option>Banana closure</option>
          <option>No peeled Banana</option>
          <option>Routine Maintenance</option>
          <option>Boiler maintenance</option>
          <option>CIP</option>
          <option>Part of failure</option>
          <option>Packing pending</option>
          <option>Power failure</option>
          <option>Other</option>
        </select>
      </div>
    </div>

    <!-- OTHER REASON -->
    <div class="field hidden" id="otherBox">
      <label class="label">Specify Other *</label>
      <input class="input" name="stop_other" id="stop_other"
        placeholder="Type stop reason">
    </div>

    <!-- SUBMIT -->
    <button class="button is-primary is-fullwidth mt-4"
      id="submitBtn" disabled>
      Submit Log Entry
    </button>

  </form>
</div>

<script>
function setValue(field, value, btn){
  document.getElementById(field).value = value;
  btn.parentElement.querySelectorAll('.button').forEach(b=>{
    b.classList.remove('is-selected');
  });
  btn.classList.add('is-selected');
  validate();
}

function setAction(value, btn){
  document.getElementById('action').value = value;

  btn.parentElement.querySelectorAll('.button').forEach(b=>{
    b.classList.remove('is-selected');
  });
  btn.classList.add('is-selected');

  const stopBox = document.getElementById('stopReasonBox');
  const otherBox = document.getElementById('otherBox');

  if(value === 'Stop'){
    stopBox.classList.remove('hidden');
  } else {
    stopBox.classList.add('hidden');
    otherBox.classList.add('hidden');
    document.getElementById('stop_reason').value = '';
    document.getElementById('stop_other').value = '';
  }

  validate();
}

function handleOther(){
  const reason = document.getElementById('stop_reason').value;
  const otherBox = document.getElementById('otherBox');

  if(reason === 'Other'){
    otherBox.classList.remove('hidden');
  } else {
    otherBox.classList.add('hidden');
    document.getElementById('stop_other').value = '';
  }
  validate();
}

function validate(){
  const line = document.getElementById('line').value;
  const action = document.getElementById('action').value;
  let valid = line && action;

  if(action === 'Stop'){
    const reason = document.getElementById('stop_reason').value;
    valid = valid && reason;
    if(reason === 'Other'){
      valid = valid && document.getElementById('stop_other').value;
    }
  }

  document.getElementById('submitBtn').disabled = !valid;
}
</script>

{% endblock %}
