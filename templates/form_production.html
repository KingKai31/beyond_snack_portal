{% extends "base.html" %}
{% block content %}

<style>
  .form-card { background:#fff; padding:28px; border-radius:18px; box-shadow:0 8px 24px rgba(0,0,0,0.08); }
  .button-active { background:#3273dc !important; color:#fff !important; }
</style>

<div class="form-card">
  <h1 class="title is-4">üìã Log Entry</h1>

  <form method="post">

    <!-- LINE -->
    <div class="field">
      <label class="label">Select Line</label>
      <div style="display:flex; gap:10px;">
        <button type="button" class="button lineBtn" data-line="Line 1">Line 1</button>
        <button type="button" class="button lineBtn" data-line="Line 2">Line 2</button>
      </div>
      <input type="hidden" name="line" id="lineInput">
    </div>

    <!-- ACTION -->
    <div class="field">
      <label class="label">Action</label>
      <div style="display:flex; gap:10px;">
        <button type="button" class="button actionBtn is-success" data-act="Start">Start</button>
        <button type="button" class="button actionBtn is-danger" data-act="Stop">Stop</button>
      </div>
      <input type="hidden" name="action" id="actionInput">
    </div>

    <!-- STOP REASON -->
    <div id="stopSection" style="display:none;">
      <div class="field">
        <label class="label">Stop Reason</label>
        <div class="select is-fullwidth">
          <select id="reasonSelect" name="stop_reason">
            <option value="">Select reason</option>
            <option>Blade change</option>
            <option>Seasoning drum cleaning</option>
            <option>Banana closure</option>
            <option>No peeled Banana</option>
            <option>Routine Maintenance</option>
            <option>Boiler maintenance</option>
            <option>CIP</option>
            <option>Part of failure</option>
            <option>Packing pending</option>
            <option>Power failure</option>
            <option>Other</option>
          </select>
        </div>
      </div>

      <div class="field">
        <input id="otherInput" class="input" name="stop_other"
          placeholder="Specify other reason" style="display:none;">
      </div>
    </div>

    <button id="submitBtn" class="button is-link is-fullwidth" disabled>Submit Log</button>

  </form>
</div>

<script>
function enable() {
  const line = document.getElementById("lineInput").value;
  const action = document.getElementById("actionInput").value;

  if (action==="Stop") {
    const reason = document.getElementById("reasonSelect").value;
    document.getElementById("submitBtn").disabled = !(line && action && reason);
  } else {
    document.getElementById("submitBtn").disabled = !(line && action);
  }
}

document.querySelectorAll(".lineBtn").forEach(btn=>{
  btn.onclick = ()=>{
    document.getElementById("lineInput").value = btn.dataset.line;
    document.querySelectorAll('.lineBtn').forEach(x=>x.classList.remove("button-active"));
    btn.classList.add("button-active");
    enable();
  };
});

document.querySelectorAll(".actionBtn").forEach(btn=>{
  btn.onclick = ()=>{
    document.getElementById("actionInput").value = btn.dataset.act;
    document.querySelectorAll('.actionBtn').forEach(x=>x.classList.remove("button-active"));
    btn.classList.add("button-active");

    if(btn.dataset.act==="Stop"){
      document.getElementById("stopSection").style.display = "block";
    } else {
      document.getElementById("stopSection").style.display = "none";
    }
    enable();
  };
});

document.getElementById("reasonSelect").onchange = ()=>{
  const v = document.getElementById("reasonSelect").value;
  document.getElementById("otherInput").style.display = (v==="Other") ? "block":"none";
  enable();
};

enable();
</script>

{% endblock %}

<button class="button is-light" onclick="history.back()" style="margin-bottom:15px;">
  ‚Üê Back
</button>
